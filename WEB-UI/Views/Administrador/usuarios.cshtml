@model List<WEB_UI.Models.usuarios>

@{
    ViewBag.Title = "Usuarios";
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">
<head>

    <title>@ViewData["Title"]</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/WebApplication1.styles.css" asp-append-version="true" />

    <link rel="stylesheet" href="~/css/usuarioVistaAdmin.css">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">


    <!--UNICO CSS PARA PAGINAS CREADAS POR CHRISTIAN -->

    <link href="~/css/severalstyles.css" rel="stylesheet" />

</head>
<body>

    <header id="header-menu" class="text-white">

        <div class="row align-items-center">
            <div class="col text-left">
                <img src="https://i.imgur.com/JisFGwG.png" id="img-logo-nav-bar" />
            </div>
            <div class="col text-center">
                <p>Sede a la que pertenece</p>
            </div>
            <div class="col text-end p-5" id="other-options">
                <i class="bi bi-person"></i>
                <span>correo@gmail.com </span>

            </div>
        </div>

    </header>
    <div class="position-relative ">
        <div class="container">
            <ul id="other-options-list" class="list-unstyled position-absolute end-0 " style="display:none;">
                <li><a asp-controller="Administrador" asp-action="DatosPersonales">Mi perfil</a></li>
                <li><a href="#">Cerrar Sesión</a></li>
            </ul>
        </div>
    </div>
    
    
    <div class="col-2">
        <a asp-controller="Administrador" asp-action="LandingAdministrador"> <p> Volver</p></a>
    </div>


    <h2>Usuarios</h2>
    

    <form id="searchForm">
        <input type="text" id="searchInput" placeholder="Buscar usuarios..." />
        <button type="button" onclick="buscar()">Buscar</button>
    </form>

    <table>
        <thead>
            <tr>
                <th>Foto de perfil</th>
                <th>Nombres</th>
                <th>Apellidos</th>
                <th>Teléfono</th>
                <th>Correo</th>
                <th>Sexo</th>
                <th>Fecha de nacimiento</th>
                <th>Edad</th>
                <th>Sede</th>
                <th>Rol</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        <!-- Aquí debería ir el código para mostrar la foto de perfil -->
                        <!-- Ejemplo: <img src=" alt="Foto de perfil" width="50" height="50"> -->
                    </td>
                    <td>
                        <input type="text" value="@item.Nombres" id="Nombres_@item.Id" />
                    </td>
                    <td>
                        <input type="text" value="@item.Apellidos" id="Apellidos_@item.Id" />
                    </td>
                    <td>
                        <input type="text" value="@item.Telefono" id="Telefono_@item.Id" />
                    </td>
                    <td>
                        <input type="text" value="@item.Correo" id="Correo_@item.Id" />
                    </td>
                    <td>
                        <select id="Sexo_@item.Id">
                            <option value="Masculino" selected="@(item.Sexo == "Masculino")">Masculino</option>
                            <option value="Femenino" selected="@(item.Sexo == "Femenino")">Femenino</option>
                        </select>
                    </td>
                    <td>
                        <input type="date" value="@item.FechaNacimiento.ToString("yyyy-MM-dd")" id="FechaNacimiento_@item.Id" />
                    </td>
                    <td>
                        <input type="text" value="@item.Edad" id="Edad_@item.Id" />
                    </td>
                    <td>
                        <input type="text" value="@item.NombreSede" id="NombreSede_@item.Id" />
                    </td>
                    <td>
                        <select id="Rol_@item.Id">
                            <option value="Doctor" selected="@(item.Doctor != null)">Doctor</option>
                            <option value="Enfermero" selected="@(item.Enfermero != null)">Enfermero</option>
                            <option value="Paciente" selected="@(item.Paciente != null)">Paciente</option>
                            <option value="Secretario" selected="@(item.Secretario != null)">Secretario</option>
                        </select>
                    </td>
                    <td>
                        <button onclick="guardarEdicion(@item.Id)">Guardar</button>
                        <button onclick="cancelarEdicion(@item.Id)">Cancelar</button>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</body>

    @Html.Partial("_Footer")

<script>
    // JavaScript para enviar los datos editados al servidor
    function guardarEdicion(userId) {
        var nombres = document.getElementById("Nombres_" + userId).value;
        var apellidos = document.getElementById("Apellidos_" + userId).value;
        var telefono = document.getElementById("Telefono_" + userId).value;
        var correo = document.getElementById("Correo_" + userId).value;
        var sexo = document.getElementById("Sexo_" + userId).value;
        var fechaNacimiento = document.getElementById("FechaNacimiento_" + userId).value;
        var edad = document.getElementById("Edad_" + userId).value;
        var nombreSede = document.getElementById("NombreSede_" + userId).value;
        var rol = document.getElementById("Rol_" + userId).value;

        // Realizar solicitud AJAX para enviar los datos editados al servidor
        fetch("/Usuarios/Editar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                id: userId,
                nombres: nombres,
                apellidos: apellidos,
                telefono: telefono,
                correo: correo,
                sexo: sexo,
                fechaNacimiento: fechaNacimiento,
                edad: edad,
                nombreSede: nombreSede,
                rol: rol
            })
        })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Error al guardar los cambios");
                }
                // Actualizar la página después de guardar los cambios
                location.reload();
            })
            .catch(error => {
                console.error(error);
                alert("Error al guardar los cambios");
            });
    }

    // JavaScript para cancelar la edición
    function cancelarEdicion(userId) {
        // Recargar la página para descartar los cambios
        location.reload();
    }

    // JavaScript para realizar la búsqueda de usuarios
    function buscar() {
        var searchTerm = document.getElementById("searchInput").value.toLowerCase();
        var table = document.querySelector("table");
        var rows = table.getElementsByTagName("tr");

        for (var i = 1; i < rows.length; i++) { // Comienza desde la segunda fila (índice 1)
            var cells = rows[i].getElementsByTagName("td");
            var found = false;
            for (var j = 0; j < cells.length; j++) {
                var cellText = cells[j].textContent.toLowerCase();
                if (cellText.includes(searchTerm)) {
                    found = true;
                    break;
                }
            }
            rows[i].style.display = found ? "" : "none";
        }
    }
</script>

